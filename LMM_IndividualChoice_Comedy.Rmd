---
title: "R Notebook"
output: html_notebook
---

# Load libraries
```{r, warning = FALSE, message = FALSE}
library(knitr)
library(rmdformats)
library(ggplot2)
library(ggpubr)
library(GGally)
library(car)
library(tidyverse)
library(lme4)
library(lmerTest)
library("MuMIn")
library(lmtest)
library(boot)
library(modelsummary)
library(pandoc)
library(tinytable)
library(ggpubr)
library(cowplot)
```

# Read dataset
```{r}
AllSubs_IndividualChoice_C <- read.csv('/Users/luisalvarez/Documents/GitHub/RM_Thesis_Neuroforecasting/ProcessedData/AllSubs_NeuralActivation_ISC_Comedy.csv')

# Filter outliers. 
#AllSubs_IndividualChoice_C <- filter(AllSubs_IndividualChoice_C, Avg_peaks_pos_yes_cooks < 0.1)

```

```{r}
#AllSubs_IndividualChoice_C$NAcc_LC_ISC

```


```{r}
ggplot(AllSubs_IndividualChoice_C, aes(x = AIns_DC_ISC, y = (W_score_scaled), color=C_preference)) +
  geom_point() +
  geom_smooth(method = "lm") +
  stat_cor() 
```


# M1_C: Behavioral data
```{r, echo = FALSE}
M1_C <- lmer(scale(W_score_scaled) ~ scale(Pos_arousal_scaled) + scale(Neg_arousal_scaled) + 
             (1|Participant) + (1|Trailer), data = AllSubs_IndividualChoice_C)
#summary(M1_C)
#r.squaredGLMM(M1_C)
#confint(M1_C)
#AIC(M1_C)
```

# Neural ISC 
Note it appears that in the full model NAcc is being flipped by positive arousal and MPFC. 
```{r, echo = FALSE}
M2_C <- lmer(scale(W_score_scaled) ~ 
               scale(NAcc_ISC) + 
               scale(AIns_ISC) + 
               scale(MPFC_ISC) +
            (1|Participant) + (1|Trailer), data = AllSubs_IndividualChoice_C)

M3_C <- lmer(scale(W_score_scaled) ~ 
               scale(Pos_arousal_scaled) + 
               scale(Neg_arousal_scaled) + 
               scale(NAcc_ISC) + 
               scale(AIns_ISC) + 
               scale(MPFC_ISC) +
            (1|Participant) + (1|Trailer), data = AllSubs_IndividualChoice_C)

ISC_list <- list(
  "Affect" = M1_C, 
  "Neuro ISC" = M2_C, 
  "Affect & Neuro ISC" = M3_C)

ISC_models <- modelsummary(ISC_list, stars=TRUE, statistic = c("t = {statistic}", "s.e. = {std.error}"), output = "ISC_models_C.docx", gof_omit = "F|RMSE|Log|Num.Obs.|SD (Observations)")
#ISC_models <- modelsummary(ISC_list, stars=TRUE, statistic = c("t = {statistic}", "s.e. = {std.error}"), 
#                           output = "dataframe", gof_omit = "F|RMSE|Log|Num.Obs.|SD (Observations)")  %>% #select(-part, -statistic)

ISC_models

```
Are NAcc_ISC and MPFC co-linear? 
```{r}
ggplot(AllSubs_IndividualChoice_C, aes(x = NAcc_ISC, y = (MPFC_ISC))) +
  geom_point() +
  geom_smooth(method = "lm") +
  stat_cor() 
  #geom_text(aes(label = Trailer), vjust = 2)
```


# Neural sequence models
Idk why, 'MPFC_middle' is so strong if it's barely correlated with 'W_score_scaled.'
```{r, echo = FALSE}
M4_C <- lmer(scale(W_score_scaled) ~ 
               scale(NAcc_onset) + 
               scale(AIns_middle) + 
               scale(MPFC_middle) +
            (1|Participant) + (1|Trailer), data = AllSubs_IndividualChoice_C)

M5_C <- lmer(scale(W_score_scaled) ~ 
               scale(Pos_arousal_scaled) + 
               scale(Neg_arousal_scaled) + 
               scale(NAcc_onset) + 
               scale(AIns_middle) + 
               scale(MPFC_middle) +
            (1|Participant) + (1|Trailer), data = AllSubs_IndividualChoice_C)

Seq_list <- list(
  "Affect" = M1_C, 
  "Neuro seq" = M4_C, 
  "Affect & Neuro seq" = M5_C)

Seq_models <- modelsummary(Seq_list, stars=TRUE, 
                           statistic = c("t = {statistic}", "s.e. = {std.error}"),
                           #output = "Seq_models_C.docx",
                           output = "dataframe",
                           gof_omit="F|RMSE|Log|Num.Obs.|SD (Observations)") 

#Seq_models <- modelsummary(Seq_list, stars=TRUE, statistic = c("t = {statistic}", "s.e. = {std.error}"),
#                           output = "dataframe", gof_omit = "F|RMSE|Log") %>% select(-part, -statistic)

Seq_models
```
```{r}
ggplot(AllSubs_IndividualChoice_C, aes(x = MPFC_middle, y = (W_score_scaled))) +
  geom_point() +
  geom_smooth(method = "lm") +
  stat_cor() 
```
# Neural dem peaks
```{r, echo = FALSE}
M6_C <- lmer(scale(W_score_scaled) ~ 
               scale(NAcc_dem_peak_pos) + 
               scale(AIns_dem_peak_pos) + 
               scale(MPFC_dem_peak_pos) +
            (1|Participant) + (1|Trailer), data = AllSubs_IndividualChoice_C)

M7_C <- lmer(scale(W_score_scaled) ~ 
               scale(Pos_arousal_scaled) + 
               scale(Neg_arousal_scaled) + 
               scale(NAcc_dem_peak_pos) + 
               scale(AIns_dem_peak_pos) + 
               scale(MPFC_dem_peak_pos) +
            (1|Participant) + (1|Trailer), data = AllSubs_IndividualChoice_C)

Dem_peaks_list <- list(
  "Affect" = M1_C, 
  "Neuro dem peaks" = M6_C, 
  "Affect & Neuro dem peaks" = M7_C)

Dem_peaks_list <- modelsummary(Dem_peaks_list, stars=TRUE, 
                               statistic = c("t = {statistic}", "s.e. = {std.error}"), 
                               #output = "Dem_peaks_C.docx", 
                               output = "dataframe",
                               gof_omit = "F|RMSE|Log|Num.Obs.|SD (Observations)")
#Dem_peaks_list <- modelsummary(Dem_peaks_list, stars=TRUE, 
#                               statistic = c("t = {statistic}", "s.e. = {std.error}"),
#                               output = "dataframe", 
#                               gof_omit = "F|RMSE|Log|Num.Obs.|SD (Observations)") %>% 
#                               select(-part, -statistic)
Dem_peaks_list
```
# Neural dem peaks yes
```{r}
M8_C <- lmer(scale(W_score_scaled) ~ 
               scale(NAcc_dem_peak_pos_yes) + 
               scale(AIns_dem_peak_pos_yes) + 
               scale(MPFC_dem_peak_pos_yes) +
            (1|Participant) + (1|Trailer), data = AllSubs_IndividualChoice_C)

M9_C <- lmer(scale(W_score_scaled) ~ 
               scale(Pos_arousal_scaled) + 
               scale(Neg_arousal_scaled) + 
               scale(NAcc_dem_peak_pos_yes) + 
               scale(AIns_dem_peak_pos_yes) + 
               scale(MPFC_dem_peak_pos_yes) +
            (1|Participant) + (1|Trailer), data = AllSubs_IndividualChoice_C)

Dem_peaks_yes_list <- list(
  "Affect" = M1_C, 
  "Neuro dem peaks yes" = M8_C, 
  "Affect & Neuro dem peaks yes" = M9_C)

Dem_peaks_yes_list <- modelsummary(Dem_peaks_yes_list, stars=TRUE, 
                                   statistic = c("t = {statistic}", "s.e. = {std.error}"), 
                                   #output = "Dem_peaks_yes_C.docx",
                                   output = "dataframe",
                                   gof_omit = "F|RMSE|Log|Num.Obs.|SD (Observations)") 
#Dem_peaks_yes_list <- modelsummary(Dem_peaks_yes_list, stars=TRUE, 
#                                   statistic = c("t = {statistic}", "s.e. = {std.error}"),
#                                   output = "dataframe", 
#                                   gof_omit = "F|RMSE|Log|Num.Obs.|SD (Observations)") %>% #select(-part, -statistic)
Dem_peaks_yes_list
# Maybe it is the case that, even though in the neuro model NAcc is a stronger predictor than MPFC, 
# in the full model PA eats a bit of NAcc and that is why MPFC turns out stronger.
```
Are NAcc_dem_peaks_pos_yes and MPFC_dem_peaks_pos_yes co-linear? 
```{r}
ggplot(AllSubs_IndividualChoice_C, aes(x = NAcc_avg_peak_yes_pos, y = (W_score_scaled), #color=C_preference
            )) +
  geom_point() +
  geom_smooth(method = "lm") +
  stat_cor() 
  # + geom_text(aes(label = Trailer), vjust = 2)
```

```{r}
M10_C <- lmer(scale(W_score_scaled) ~ 
               scale(NAcc_avg_peak_pos) + 
               scale(AIns_avg_peak_pos) + 
               scale(MPFC_avg_peak_pos) +
            (1|Participant) + (1|Trailer), data = AllSubs_IndividualChoice_C)

M11_C <- lmer(scale(W_score_scaled) ~ 
               scale(Pos_arousal_scaled) + 
               scale(Neg_arousal_scaled) + 
               scale(NAcc_avg_peak_pos) + 
               scale(AIns_avg_peak_pos) + 
               scale(MPFC_avg_peak_pos) +
            (1|Participant) + (1|Trailer), data = AllSubs_IndividualChoice_C)

Avg_peaks_list <- list(
  "Affect" = M1_C, 
  "Neuro AVG " = M10_C, 
  "Affect & Neuro AVG" = M11_C)

Avg_peaks_list <- modelsummary(Avg_peaks_list, stars=TRUE, 
                               statistic = c("t = {statistic}", "s.e. = {std.error}"), 
                               #output = "Avg_peaks_C.docx", 
                               output = "dataframe",
                               gof_omit = "F|RMSE|Log|Num.Obs.|SD (Observations)") 
#Avg_peaks_list <- modelsummary(Avg_peaks_list, stars=TRUE, 
#                                   statistic = c("t = {statistic}", "s.e. = {std.error}"),
#                                   output = "dataframe", gof_omit = "F|RMSE|Log|Num.Obs.|SD (Observations)") %>% select(-part, -statistic)
Avg_peaks_list
```

```{r}
M12_C <- lmer(scale(W_score_scaled) ~ 
               scale(NAcc_avg_peak_yes_pos) + 
               scale(AIns_avg_peak_yes_pos) + 
               scale(MPFC_avg_peak_yes_pos) +
            (1|Participant) + (1|Trailer), data = AllSubs_IndividualChoice_C)

M13_C <- lmer(scale(W_score_scaled) ~ 
               scale(Pos_arousal_scaled) + 
               scale(Neg_arousal_scaled) + 
               scale(NAcc_avg_peak_yes_pos) + 
               scale(AIns_avg_peak_yes_pos) + 
               scale(MPFC_avg_peak_yes_pos) +
            (1|Participant) + (1|Trailer), data = AllSubs_IndividualChoice_C)

Avg_peaks_yes_list <- list(
  "Affect" = M1_C, 
  "Neuro avg peaks yes" = M12_C, 
  "Affect & Neuro dem peaks yes" = M13_C)

Avg_peaks_yes_list <- modelsummary(Avg_peaks_yes_list, stars=TRUE, 
                                   statistic = c("t = {statistic}", "s.e. = {std.error}"), 
                                   #output = "Avg_peaks_yes_C.docx", 
                                   output = "dataframe",
                                   gof_omit = "F|RMSE|Log|Num.Obs.|SD (Observations)") 
#Avg_peaks_yes_list <- modelsummary(Avg_peaks_yes_list, stars=TRUE, 
#                                   statistic = c("t = {statistic}", "s.e. = {std.error}"), 
#                                   output = "dataframe", 
#                                   gof_omit = "F|RMSE|Log|Num.Obs.|SD (Observations)") %>% 
#                                   select(-part, -statistic)
Avg_peaks_yes_list
```
```{r}
ggplot(AllSubs_IndividualChoice_C, aes(x = NAcc_avg_peak_yes_pos, y = (W_score_scaled))) +
  geom_point() +
  geom_smooth(method = "lm") +
  stat_cor() 
```
Plot graphs for NAcc.
```{r}
ggplot(AllSubs_IndividualChoice_C, aes(x=NAcc_dem_peak_pos_yes, y=(W_score_scaled),)) +
  labs(y = "Watch Score", x = "NAcc DPy") + 
  geom_point() +
  geom_smooth(method = "lm") +
  stat_cor(aes()) +
  theme(legend.position="none")
```


```{r}
#NAcc onset.
NAcc_plot_1 <- ggplot(AllSubs_IndividualChoice_C, aes(x=NAcc_onset, y=(W_score_scaled))) +
  labs(y = "Watch Score", x = "NAcc onset") + 
  geom_point() +
  geom_smooth(method = "lm") +
  stat_cor(aes(color = "cyan")) +
  theme(legend.position="none")
#NAcc_dem_peak_pos
NAcc_plot_2 <- ggplot(AllSubs_IndividualChoice_C, aes(x=NAcc_dem_peak_pos, y = (W_score_scaled))) +
  labs(y = "Watch Score", x = "NAcc DP") + 
  geom_point() +
  geom_smooth(method = "lm") +
  stat_cor() 
#NAcc_dem_peak_pos_yes
NAcc_plot_3 <- ggplot(AllSubs_IndividualChoice_C, aes(x=NAcc_dem_peak_pos_yes, y = (W_score_scaled))) +
  labs(y = "Watch Score", x = "NAcc DPy") + 
  geom_point() +
  geom_smooth(method = "lm") +
  stat_cor() 
#NAcc_avg_peak_yes_pos
NAcc_plot_4 <- ggplot(AllSubs_IndividualChoice_C, aes(x=NAcc_avg_peak_yes_pos, y = (W_score_scaled))) +
  labs(y = "Watch Score", x = "NAcc AVGy") + 
  geom_point() +
  geom_smooth(method = "lm") +
  stat_cor() 

#ggarrange(NAcc_plot_1, NAcc_plot_2, NAcc_plot_3, NAcc_plot_4, 
          #labels = c("NAcc onset", "NAcc DP", "NAcc DPy", "NAcc AVGy"),
          #ncol = 4, nrow = 1, align="h")

plot_grid(NAcc_plot_1, NAcc_plot_2, nrow=1, align="v")

#ggdraw() +
  #draw_plot(NAcc_plot_1, x = 0.5, y = 0.5, width = .35, height = .55) 
  #draw_plot(NAcc_plot_2, x = .29, y = .4, width = .35, height = .55) 
  #draw_plot(NAcc_plot_3, x = .5, y = 0, width = .5, height = .5) +
  #draw_plot(NAcc_plot_4, x = 0, y = 0, width = .5, height = .5) 

```




